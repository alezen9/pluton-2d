---
import { getCollection } from "astro:content";
import ExamplesLayout from "@views/examples/ExamplesLayout.astro";
import { exampleCategoryOrder } from "../../content.config";
import { hiddenExampleCategories } from "../../content.config";
import type { ExampleCategory } from "../../content.config";

const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, "");
const exampleCollection = await getCollection("examples");
const isHiddenExample = (entryId: string, category: ExampleCategory) =>
  entryId.startsWith("drafts/") || hiddenExampleCategories.includes(category);

type ExampleOverviewItem = {
  id: string;
  title: string;
  description: string;
};

const exampleItemsByCategory: Partial<Record<ExampleCategory, ExampleOverviewItem[]>> = {};

for (const exampleEntry of exampleCollection) {
  const category = exampleEntry.data.category;
  if (isHiddenExample(exampleEntry.id, category)) continue;
  if (!exampleItemsByCategory[category]) {
    exampleItemsByCategory[category] = [];
  }

  exampleItemsByCategory[category].push({
    id: exampleEntry.id,
    title: exampleEntry.data.title,
    description: exampleEntry.data.description,
  });
}

const orderedCategories = exampleCategoryOrder.filter(
  (category) =>
    !hiddenExampleCategories.includes(category) && exampleItemsByCategory[category],
);
---

<ExamplesLayout title="Examples">
  <div class="examples-overview">
    <h1>Examples</h1>
    <p class="examples-overview-lead">
      Interactive demos that mirror the real `src` API surface: geometry paths,
      dimensions, filters, and static vs dynamic rendering behavior.
    </p>

    {
      orderedCategories.map((category) => (
        <section class="examples-category-section">
          <h2>{category}</h2>
          <div class="examples-grid">
            {(exampleItemsByCategory[category] ?? []).map((exampleItem) => (
              <a
                class="example-overview-card"
                href={`${baseUrl}/examples/${exampleItem.id}`}
              >
                <h3>{exampleItem.title}</h3>
                <p>{exampleItem.description}</p>
              </a>
            ))}
          </div>
        </section>
      ))
    }
  </div>
</ExamplesLayout>

<style>
  .examples-overview {
    max-width: 980px;
  }

  .examples-overview h1 {
    margin-bottom: 0.35rem;
  }

  .examples-overview-lead {
    font-size: 0.95rem;
    margin-bottom: 1.25rem;
  }

  .examples-category-section {
    margin-bottom: 5.5rem;
  }

  .examples-category-section h2 {
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-top: 0;
    margin-bottom: 0.6rem;
  }

  .examples-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
  }

  .example-overview-card {
    display: block;
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: var(--radius);
    padding: 0.75rem;
    text-decoration: none;
    transition:
      border-color 0.15s,
      transform 0.15s,
      background 0.15s;
  }

  .example-overview-card:hover {
    border-color: var(--accent);
    background: color-mix(in oklab, var(--accent-light) 35%, var(--panel-bg));
    text-decoration: none;
    transform: translateY(-1px);
  }

  .example-overview-card h3 {
    font-size: 0.95rem;
    margin: 0 0 0.2rem;
    color: var(--text-main);
  }

  .example-overview-card p {
    font-size: 0.82rem;
    margin: 0;
    color: var(--text-muted);
  }

  @media (max-width: 768px) {
    .examples-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
