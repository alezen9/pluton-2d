---
import { getCollection } from "astro:content";
import Layout from "@views/examples/layout.astro";

const base = import.meta.env.BASE_URL.replace(/\/$/, "");
const examples = await getCollection("examples");

const CATEGORY_ORDER = ["Drawing", "Profiles", "Effects", "Behavior"];

const byCategory: Record<
  string,
  Array<{
    id: string;
    title: string;
    description: string;
  }>
> = {};

for (const ex of examples) {
  (byCategory[ex.data.category] ??= []).push({
    id: ex.id,
    title: ex.data.title,
    description: ex.data.description,
  });
}

for (const key of Object.keys(byCategory)) {
  byCategory[key].sort((a, b) => a.title.localeCompare(b.title));
}

const orderedCategories = [
  ...CATEGORY_ORDER.filter((category) => byCategory[category]),
  ...Object.keys(byCategory).filter((category) => !CATEGORY_ORDER.includes(category)).sort(),
];
---

<Layout title="Examples">
  <div class="examples-overview">
    <h1>Examples</h1>
    <p class="examples-overview-lead">
      Interactive demos that mirror the real `src` API surface: geometry paths,
      dimensions, filters, and static vs dynamic rendering behavior.
    </p>

    {orderedCategories.map((category) => (
      <section class="examples-category-section">
        <h2>{category}</h2>
        <div class="examples-grid">
          {byCategory[category].map((item) => (
            <a class="example-overview-card" href={`${base}/examples/${item.id}`}>
              <h3>{item.title}</h3>
              <p>{item.description}</p>
            </a>
          ))}
        </div>
      </section>
    ))}
  </div>
</Layout>

<style>
  .examples-overview {
    max-width: 980px;
  }

  .examples-overview h1 {
    margin-bottom: 0.35rem;
  }

  .examples-overview-lead {
    font-size: 0.95rem;
    margin-bottom: 1.25rem;
  }

  .examples-category-section {
    margin-bottom: 1.5rem;
  }

  .examples-category-section h2 {
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-top: 0;
    margin-bottom: 0.6rem;
  }

  .examples-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 0.65rem;
  }

  .example-overview-card {
    display: block;
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: var(--radius);
    padding: 0.75rem;
    text-decoration: none;
    transition: border-color 0.15s, transform 0.15s, background 0.15s;
  }

  .example-overview-card:hover {
    border-color: var(--accent);
    background: color-mix(in oklab, var(--accent-light) 35%, var(--panel-bg));
    text-decoration: none;
    transform: translateY(-1px);
  }

  .example-overview-card h3 {
    font-size: 0.95rem;
    margin: 0 0 0.2rem;
    color: var(--text-main);
  }

  .example-overview-card p {
    font-size: 0.82rem;
    margin: 0;
    color: var(--text-muted);
  }

  @media (max-width: 768px) {
    .examples-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
